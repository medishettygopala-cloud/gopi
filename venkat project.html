<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>To-Do List</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(-45deg,#1e3c72,#2a5298,#1c92d2,#0f2027);
  background-size:400% 400%;
  animation:gradient 10s ease infinite;
  min-height:100vh;
}
@keyframes gradient{
0%{background-position:0% 50%;}
50%{background-position:100% 50%;}
100%{background-position:0% 50%;}
}

.app{
  max-width:900px;
  margin:40px auto;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(15px);
  border-radius:20px;
  padding:25px;
  color:white;
}

.task{
  background:rgba(255,255,255,0.08);
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.task.completed span{
  text-decoration:line-through;
  color:#00ffae;
}

.priority-high{color:#ff4d4d;}
.priority-medium{color:#ffc107;}
.priority-low{color:#0dcaf0;}

.progress{height:10px;}
</style>
</head>

<body>

<div class="app">

<h3 class="mb-3"><i class="bi bi-list-check"></i> To-Do List</h3>

<form id="taskForm" class="row g-2">
<div class="col-md-3">
<input type="text" id="taskInput" class="form-control" placeholder="Enter task..." required>
</div>

<div class="col-md-2">
<select id="priority" class="form-select">
<option value="low">Low</option>
<option value="medium" selected>Medium</option>
<option value="high">High</option>
</select>
</div>

<div class="col-md-2">
<select id="category" class="form-select">
<option>Study</option>
<option>Work</option>
<option>Personal</option>
<option>Fitness</option>
</select>
</div>

<div class="col-md-2">
<input type="date" id="dueDate" class="form-control">
</div>

<div class="col-md-3 d-grid">
<button class="btn btn-primary" type="submit" id="submitBtn">
<i class="bi bi-plus-circle"></i> Add Task
</button>
</div>
</form>

<hr>

<input type="text" id="search" class="form-control mb-3" placeholder="Search...">

<div class="mb-3">
<button class="btn btn-outline-light btn-sm" onclick="setFilter('all')">All</button>
<button class="btn btn-outline-light btn-sm" onclick="setFilter('active')">Active</button>
<button class="btn btn-outline-light btn-sm" onclick="setFilter('completed')">Completed</button>
<button class="btn btn-outline-light btn-sm" onclick="setFilter('high')">High</button>
</div>

<div class="mb-3">
<div class="progress">
<div id="progressBar" class="progress-bar bg-success"></div>
</div>
<small id="stats"></small>
</div>

<div id="taskList"></div>

<button class="btn btn-danger btn-sm mt-3" onclick="clearAll()">
<i class="bi bi-trash"></i> Clear All
</button>

<hr>
<h5><i class="bi bi-recycle"></i> Recycle Bin</h5>
<div id="deletedList"></div>

</div>

<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3">
<div id="toast" class="toast text-bg-danger">
<div class="toast-body" id="toastMsg"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
let deletedTasks = JSON.parse(localStorage.getItem('deletedTasks')) || [];
let filter = 'all';
let editingId = null;

const form = document.getElementById('taskForm');
const list = document.getElementById('taskList');
const progressBar = document.getElementById('progressBar');
const stats = document.getElementById('stats');
const searchInput = document.getElementById('search');
const submitBtn = document.getElementById('submitBtn');
const toastMsg = document.getElementById('toastMsg');
const taskInput = document.getElementById('taskInput');
const priority = document.getElementById('priority');
const category = document.getElementById('category');
const dueDate = document.getElementById('dueDate');


// ‚úÖ Disable past dates in calendar
dueDate.min = new Date().toISOString().split("T")[0];

function save(){
localStorage.setItem('tasks',JSON.stringify(tasks));
localStorage.setItem('deletedTasks',JSON.stringify(deletedTasks));
}

function showToast(message,color="danger"){
const toastEl = document.getElementById('toast');
toastEl.className = "toast text-bg-"+color;
toastMsg.innerText = message;
new bootstrap.Toast(toastEl).show();
}

function render(){
list.innerHTML="";

let filtered = tasks.filter(task=>{
if(filter==='active') return !task.completed;
if(filter==='completed') return task.completed;
if(filter==='high') return task.priority==='high';
return true;
});

filtered = filtered.filter(t =>
t.text.toLowerCase().includes(searchInput.value.toLowerCase())
);

filtered.forEach(task=>{
const div=document.createElement('div');
div.className="task "+(task.completed?"completed":"");

div.innerHTML=`
<div>
<span class="priority-${task.priority}">${task.text}</span>
<small> (${task.category})</small>
<small> ${task.due||""}</small>
</div>

<div>
<button class="btn btn-sm btn-success" onclick="toggle('${task.id}')">
<i class="bi ${task.completed?'bi-arrow-counterclockwise':'bi-check'}"></i>
</button>

<button class="btn btn-sm btn-warning" onclick="editTask('${task.id}')">
<i class="bi bi-pencil"></i>
</button>

<button class="btn btn-sm btn-danger" onclick="removeTask('${task.id}')">
<i class="bi bi-trash"></i>
</button>
</div>
`;

list.appendChild(div);
});

updateProgress();
}

function renderDeleted(){
const deletedList = document.getElementById('deletedList');
deletedList.innerHTML="";

deletedTasks.forEach(task=>{
const div=document.createElement('div');
div.className="task";

div.innerHTML=`
<div>
<span class="text-danger">${task.text}</span>
<small> (${task.category})</small>
</div>

<div>
<button class="btn btn-sm btn-success" onclick="restoreTask('${task.id}')">
<i class="bi bi-arrow-counterclockwise"></i>
</button>

<button class="btn btn-sm btn-danger" onclick="deleteForever('${task.id}')">
<i class="bi bi-x-circle"></i>
</button>
</div>
`;

deletedList.appendChild(div);
});
}

function updateProgress(){
let completed = tasks.filter(t=>t.completed).length;
let total = tasks.length;
let percent = total?Math.round((completed/total)*100):0;
progressBar.style.width = percent+"%";
stats.innerText = `${completed} of ${total} completed (${percent}%)`;
}

form.addEventListener('submit',e=>{
e.preventDefault();

let taskText = taskInput.value.trim();
let today = new Date().toISOString().split("T")[0];

// ‚úÖ Prevent past date manually
if(dueDate.value && dueDate.value < today){
showToast("Previous dates are not allowed ‚ùå");
return;
}

if(editingId){
tasks = tasks.map(t =>
t.id==editingId
? {...t,text:taskText,priority:priority.value,category:category.value,due:dueDate.value}
: t
);
editingId=null;
submitBtn.innerHTML='<i class="bi bi-plus-circle"></i> Add Task';
showToast("Task Updated Successfully ‚úèÔ∏è","success");
}else{
tasks.unshift({
id:Date.now(),
text:taskText,
priority:priority.value,
category:category.value,
due:dueDate.value,
completed:false
});
showToast("Task Added Successfully ‚úÖ","success");
}

save();
render();
form.reset();
});

function editTask(id){
let task = tasks.find(t=>t.id==id);
if(!task) return;

taskInput.value = task.text;
priority.value = task.priority;
category.value = task.category;
dueDate.value = task.due || "";

editingId = id;
submitBtn.innerHTML='<i class="bi bi-save"></i> Update Task';
window.scrollTo({top:0,behavior:'smooth'});
}

function toggle(id){
tasks = tasks.map(t =>
t.id==id ? {...t,completed:!t.completed} : t
);
save(); render();
}

function removeTask(id){
let task = tasks.find(t => t.id == id);
if(!task) return;

deletedTasks.unshift(task);
tasks = tasks.filter(t => t.id != id);

showToast("Task moved to Recycle Bin üóë","warning");

save();
render();
renderDeleted();
}

function restoreTask(id){
let task = deletedTasks.find(t=>t.id==id);
if(!task) return;

tasks.unshift(task);
deletedTasks = deletedTasks.filter(t=>t.id!=id);

showToast("Task Restored Successfully ‚ôªÔ∏è","success");

save();
render();
renderDeleted();
}

function deleteForever(id){
deletedTasks = deletedTasks.filter(t=>t.id!=id);

showToast("Task Deleted Permanently ‚ùå","danger");

save();
renderDeleted();
}

function clearAll(){
if(confirm("Delete all tasks?")){
deletedTasks = deletedTasks.concat(tasks);
tasks=[];
save();
render();
renderDeleted();
}
}

function setFilter(f){filter=f; render();}
searchInput.addEventListener('input',render);

render();
renderDeleted();
</script>

</body>
</html>